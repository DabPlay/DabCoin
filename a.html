<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>GameSwap</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body { font-family: Arial; background:#0f1117; color:#fff; }
    button { padding:10px; margin:5px; }
    input { padding:8px; width:200px; }
    .ok { color:#4caf50 }
    .err { color:#f44336 }
  </style>
</head>
<body>

<h2>ðŸŽ® GameSwap</h2>

<button id="connect">Conectar Wallet</button>
<p id="account"></p>

<hr>

<p>DBN: <span id="dbnBal">-</span></p>
<p>DAB: <span id="dabBal">-</span></p>

<input id="amount" placeholder="Cantidad" disabled />

<br><br>

<button id="buy" disabled>Comprar DAB</button>
<button id="sell" disabled>Vender DAB</button>
<p id="preview"></p>
<p id="status"></p>
 <script>
let provider, signer, user;
let mode = "buy"; // ðŸ”¥ AGREGADO

const SWAP = "0xE1d8F4306eF5F0f43804E485Cf9434988ECC828b";
const DBN  = "0x2fD13338f4e9485fC33Be4DE53F4f6ff536811cD";
const DAB  = "0x996fDE168B25dcA1A4aA9A2833e4fd6d7920B4c5";

const ERC20_ABI = [
  "function balanceOf(address) view returns (uint256)",
  "function approve(address,uint256)",
  "function allowance(address,address) view returns (uint256)",
  "function decimals() view returns (uint8)"
];

const SWAP_ABI = [
  "function buy(uint256)",
  "function sell(uint256)",
  "function quoteBuy(uint256) view returns (uint256)",
  "function quoteSell(uint256) view returns (uint256)",
  "function paused() view returns (bool)"
];

const $ = id => document.getElementById(id);

$("connect").onclick = async () => {
  provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = provider.getSigner();
  user = await signer.getAddress();
  await loadBalances();
};

async function loadBalances() {
  const dbn = new ethers.Contract(DBN, ERC20_ABI, provider);
  const dab = new ethers.Contract(DAB, ERC20_ABI, provider);

  const [dbnD, dabD] = await Promise.all([dbn.decimals(), dab.decimals()]);
  const [dbnB, dabB] = await Promise.all([
    dbn.balanceOf(user),
    dab.balanceOf(user)
  ]);

  $("dbnBal").textContent = ethers.utils.formatUnits(dbnB, dbnD);
  $("dabBal").textContent = ethers.utils.formatUnits(dabB, dabD);
}

$("buy").onclick = () => mode = "buy";
$("sell").onclick = () => mode = "sell";

$("amount").oninput = async () => {
  const amount = $("amount").value;
  if (!amount || !provider) return;

  const swap = new ethers.Contract(SWAP, SWAP_ABI, provider);
  const dbn = new ethers.Contract(DBN, ERC20_ABI, provider);
  const dab = new ethers.Contract(DAB, ERC20_ABI, provider);

  const [dbnDec, dabDec] = await Promise.all([
    dbn.decimals(),
    dab.decimals()
  ]);

  if (mode === "buy") {
    const dbnIn = ethers.utils.parseUnits(amount, dbnDec);
    const dabOut = await swap.quoteBuy(dbnIn);
    $("preview").textContent =
      `Recibes ${ethers.utils.formatUnits(dabOut, dabDec)} DAB`;
  }

  if (mode === "sell") {
    const dabIn = ethers.utils.parseUnits(amount, dabDec);
    const dbnOut = await swap.quoteSell(dabIn);
    $("preview").textContent =
      `Recibes ${ethers.utils.formatUnits(dbnOut, dbnDec)} DBN`;
  }
};
</script>
</body>
</html>
